<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ブーストエリア選択ツール</title>
    <style>
        .grid {
            display: grid;
            grid-template-columns: repeat(8, 40px);
            grid-template-rows: repeat(6, 40px);
            gap: 2px;
            margin-bottom: 20px;
        }
        .cell {
            width: 40px;
            height: 40px;
            border: 2px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .overlap {
            border: 4px solid darkred !important;
        }
        .overlap::after {
            content: '\25CB'; /* Unicode circle */
            color: darkred;
            font-size: 20px;
            position: absolute;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        .character-select {
            display: flex;
            flex-direction: column;
        }
        .summary {
            margin-bottom: 20px;
        }
        .deck-list {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h2>グリッド選択ツール</h2>
    <div class="controls" id="controls"></div>
    <button onclick="saveDeck()">デッキを保存する</button>
    <div class="summary" id="summary"></div>
    <div class="grid" id="grid"></div>
    <div class="deck-list" id="deckList"></div>

    <script>
        const characters = {
            "ルルー": { color: "#FFCCCC", positions: [[2,0], [2,1], [1,1], [1,2], [1,3], [0,3], [0,4]] },
            "アルル": { color: "#CCCCFF", positions: [[4,0], [3,1], [3,2], [3,3], [4,2], [4,3], [4,4]] },
            "ドラコ": { color: "#CCFFCC", positions: [[5,0], [5,1], [6,1], [6,2], [6,3], [7,3], [7,4]] },
            "ウィッチ": { color: "#FFFFCC", positions: [[0,0], [1,0], [0,1], [0,2], [2,2], [2,3], [1,4]] },
            "シェゾ": { color: "#E0CCFF", positions: [[6,0], [7,0], [7,1], [7,2], [5,2], [5,3], [6,4]] },
            "リンゴ": { color: "#FFCCE5", positions: [[5,0], [6,0], [6,1], [6,2], [5,2], [6,3], [5,4]] },
            "まぐろ": { color: "#CCE5FF", positions: [[1,0], [2,0], [1,1], [1,2], [2,2], [1,3], [0,4]] },
            "りすクマ先輩": { color: "#E5CC99", positions: [[3,0], [4,0], [3,2], [4,2], [3,3], [3,4], [2,3]] },
            "ラフィーナ": { color: "#FFD700", positions: [[6,0], [6,1], [7,1], [5,2], [5,3], [7,3], [6,4]] },
            "クルーク": { color: "#9933CC", positions: [[1,0], [0,1], [1,1], [2,2], [0,3], [2,3], [1,4]] }
        };

        const controls = document.getElementById("controls");
        for (let i = 0; i < 6; i++) {
            const div = document.createElement("div");
            div.className = "character-select";
            const label = document.createElement("label");
            label.textContent = `キャラクター枠${i+1}：`;
            const select = document.createElement("select");
            select.className = "selection";
            select.innerHTML = `<option value="なし">なし</option>` + Object.keys(characters).map(name => `<option value="${name}">${name}</option>`).join('');
            div.appendChild(label);
            div.appendChild(select);
            controls.appendChild(div);
        }

        const grid = document.getElementById("grid");
        const summary = document.getElementById("summary");
        const deckList = document.getElementById("deckList");
        const selections = document.querySelectorAll(".selection");
        let deckHistory = [];

        function updateGrid() {
            document.querySelectorAll(".cell").forEach(cell => {
                cell.style.backgroundColor = "";
                cell.classList.remove("overlap");
                cell.textContent = "";
            });

            let occupied = {};
            selections.forEach(select => {
                const char = select.value;
                if (char !== "なし" && characters[char]) {
                    characters[char].positions.forEach(([x, y]) => {
                        const key = `${x},${y}`;
                        const cell = document.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
                        if (cell) {
                            cell.style.backgroundColor = characters[char].color;
                            occupied[key] = (occupied[key] || 0) + 1;
                        }
                    });
                }
            });

            let overlap = 0, unique = 0;
            Object.entries(occupied).forEach(([key, count]) => {
                const [x, y] = key.split(',');
                const cell = document.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
                if (count > 1) {
                    overlap++;
                    if (cell) {
                        cell.classList.add("overlap");
                    }
                } else {
                    unique++;
                }
            });

            summary.innerHTML = `重なっていないブーストエリアの数: ${unique}<br>重なっているブーストエリアの数: ${overlap}`;
        }

        for (let y = 5; y >= 0; y--) {
            for (let x = 0; x < 8; x++) {
                const cell = document.createElement("div");
                cell.className = "cell";
                cell.dataset.x = x;
                cell.dataset.y = y;
                grid.appendChild(cell);
            }
        }

        selections.forEach(select => select.addEventListener("change", updateGrid));

        function saveDeck() {
            const chosen = Array.from(selections).map(sel => sel.value);
            const uniqueDeckKey = chosen.join(",");

            let occupied = {};
            chosen.forEach(name => {
                if (name !== "なし" && characters[name]) {
                    characters[name].positions.forEach(([x, y]) => {
                        const key = `${x},${y}`;
                        occupied[key] = (occupied[key] || 0) + 1;
                    });
                }
            });

            let overlap = 0, unique = 0;
            Object.values(occupied).forEach(count => {
                if (count > 1) overlap++;
                else unique++;
            });

            const div = document.createElement("div");
            div.innerHTML = `<strong>デッキ:</strong> ${chosen.join(' / ')}<br>
                            重なっていないブーストエリアの数: ${unique}<br>
                            重なっているブーストエリアの数: ${overlap}`;

            deckList.appendChild(div);
        }
    </script>
</body>
</html>
