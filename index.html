<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ブーストエリア重なり確認ツール</title>
    <style>
        .grid {
            display: grid;
            grid-template-columns: repeat(8, 40px);
            grid-template-rows: repeat(6, 40px);
            gap: 2px;
            margin-bottom: 20px;
        }
        .cell {
            width: 40px;
            height: 40px;
            background-color: white;
            position: relative;
        }
        .overlap::after {
            content: '◯';
            color: darkred;
            font-size: 24px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        .character-select {
            display: flex;
            flex-direction: column;
        }
        table {
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 5px 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h2>ブーストエリア重なり確認ツール</h2>
    <div class="controls" id="controls"></div>
    <button id="saveDeck">デッキを保存する</button>
    <p id="countDisplay"></p>
    <div class="grid" id="grid"></div>
    <h3>保存されたデッキ</h3>
    <table id="savedDecks">
        <thead>
            <tr><th>デッキ</th><th>重なりなし</th><th>重なりあり</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const characters = {
            "ルルー": { color: "#FFCCCC", positions: [[2,0], [2,1], [1,1], [1,2], [1,3], [0,3], [0,4]] },
            "アルル": { color: "#CCCCFF", positions: [[4,0], [3,1], [3,2], [3,3], [4,2], [4,3], [4,4]] },
            "ドラコ": { color: "#CCFFCC", positions: [[5,0], [5,1], [6,1], [6,2], [6,3], [7,3], [7,4]] },
            "ウィッチ": { color: "#FFFFCC", positions: [[0,0], [1,0], [0,1], [0,2], [2,2], [2,3], [1,4]] },
            "シェゾ": { color: "#E0CCFF", positions: [[6,0], [7,0], [7,1], [7,2], [5,2], [5,3], [6,4]] },
            "リンゴ": { color: "#FFCCE5", positions: [[5,0], [6,0], [6,1], [6,2], [5,2], [6,3], [5,4]] },
            "まぐろ": { color: "#CCE5FF", positions: [[1,0], [2,0], [1,1], [1,2], [2,2], [1,3], [0,4]] },
            "りすクマ先輩": { color: "#E5CC99", positions: [[3,0], [4,0], [3,2], [4,2], [3,3], [3,4], [2,3]] },
            "ラフィーナ": { color: "#FFD700", positions: [[6,0],[6,1],[7,1],[5,2],[5,3],[7,3],[6,4]] },
            "クルーク": { color: "#800080", positions: [[1,0],[0,1],[1,1],[2,2],[0,3],[2,3],[1,4]] }
        };

        const controls = document.getElementById("controls");
        for (let i = 1; i <= 6; i++) {
            const div = document.createElement("div");
            div.className = "character-select";
            div.innerHTML = `<label>キャラクター枠${i}:</label><select class="selection"><option value="なし">なし</option>${Object.keys(characters).map(char => `<option value="${char}">${char}</option>`).join('')}</select>`;
            controls.appendChild(div);
        }

        const grid = document.getElementById("grid");
        const selections = document.querySelectorAll(".selection");
        const countDisplay = document.getElementById("countDisplay");
        const savedDecksBody = document.querySelector("#savedDecks tbody");
        const savedConfigs = [];

        for (let y = 5; y >= 0; y--) {
            for (let x = 0; x < 8; x++) {
                const cell = document.createElement("div");
                cell.className = "cell";
                cell.dataset.x = x;
                cell.dataset.y = y;
                grid.appendChild(cell);
            }
        }

        function updateGrid() {
            document.querySelectorAll(".cell").forEach(cell => {
                cell.style.backgroundColor = "white";
                cell.classList.remove("overlap");
                cell.textContent = "";
            });

            let occupied = {};
            selections.forEach(select => {
                const char = select.value;
                if (char !== "なし" && characters[char]) {
                    characters[char].positions.forEach(([x, y]) => {
                        const key = `${x},${y}`;
                        const cell = document.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
                        if (cell) {
                            cell.style.backgroundColor = characters[char].color;
                            occupied[key] = (occupied[key] || 0) + 1;
                            if (occupied[key] > 1) {
                                cell.classList.add("overlap");
                                cell.textContent = "◯";
                            }
                        }
                    });
                }
            });

            const total = Object.values(occupied).reduce((acc, v) => acc + 1, 0);
            const overlap = Object.values(occupied).filter(v => v > 1).length;
            const nonOverlap = total - overlap;
            countDisplay.textContent = `重なっていない: ${nonOverlap}個 ／ 重なっている: ${overlap}個`;
            return { nonOverlap, overlap };
        }

        selections.forEach(select => select.addEventListener("change", updateGrid));

        document.getElementById("saveDeck").addEventListener("click", () => {
            const current = Array.from(selections).map(s => s.value);
            if (current.every(c => c === "なし")) return;

            const duplicate = savedConfigs.some(cfg => JSON.stringify(cfg.decks) === JSON.stringify(current));
            if (!duplicate) {
                const result = updateGrid();
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${current.join(', ')}</td><td>${result.nonOverlap}</td><td>${result.overlap}</td>`;
                savedDecksBody.appendChild(tr);
                savedConfigs.push({ decks: current });
            }
        });

        updateGrid();
    </script>
</body>
</html>
